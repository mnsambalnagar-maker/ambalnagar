<!DOCTYPE html>
<html lang="en">
<head>
  <title>Login - Sri Ambal Nagar Admin Portal</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- üîí DESIGN UNCHANGED -->
  <style>
    /* ‚ö†Ô∏è SAME DESIGN ‚Äì DO NOT MODIFY */
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family:'Poppins',sans-serif;
      min-height:100vh;
      background:
        radial-gradient(circle at 20% 20%, rgba(254,252,64,0.25) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(59,130,246,0.35) 0%, transparent 50%),
        linear-gradient(135deg,#0f172a 0%,#1d2b64 40%,#2a3b8f 100%);
      background-attachment:fixed;
      display:flex;
      flex-direction:column;
    }
    .nav-wrap{width:100%;padding:16px 34px;position:sticky;top:0;z-index:20;}
    .nav-bar{max-width:1200px;margin:0 auto;padding:10px 18px;border-radius:999px;background:rgba(15,23,42,0.42);border:1px solid rgba(148,163,184,0.5);backdrop-filter:blur(18px);display:flex;align-items:center;justify-content:space-between;color:#e5e7eb;}
    .page-main{flex:1;display:grid;grid-template-columns:1.2fr 1fr;}
    .login-left{padding:40px 70px;color:#e5e7eb;}
    .login-right{background:#fff;padding:40px 70px;}
    .login-btn{width:100%;padding:14px;border-radius:999px;border:none;background:linear-gradient(135deg,#2563eb,#1d4ed8);color:#fff;font-weight:600;cursor:pointer}
    #otpBox{display:none;margin-top:26px;padding-top:22px;border-top:1px dashed #94a3b8}
    #otpMsg{margin-top:10px;font-size:.9rem;text-align:center}
    @media(max-width:960px){.page-main{grid-template-columns:1fr}}
  </style>
</head>

<body>

<header class="nav-wrap">
  <div class="nav-bar">
    <div>Sri Ambal Nagar Admin</div>
    <div>Admin Login</div>
  </div>
</header>

<main class="page-main">

<section class="login-left">
  <h1>Sri Ambal Nagar</h1>
  <p>Admin Portal ‚Äì Secure Email OTP Login</p>
</section>

<section class="login-right">
  <h2>Secure Login</h2>

  <!-- STEP 1 -->
  <form id="loginForm">
    <input id="username" placeholder="Username" required><br><br>
    <input id="password" type="password" placeholder="Password" required><br><br>
    <input id="email" type="email" placeholder="Email" required><br><br>
    <button type="submit" class="login-btn">Send OTP</button>
  </form>

  <!-- STEP 2 -->
  <div id="otpBox">
    <input id="otp" placeholder="Enter OTP"><br><br>
    <button id="verifyBtn" class="login-btn">Verify & Login</button>
    <div id="otpMsg"></div>
  </div>

</section>
</main>

<script>
const loginForm = document.getElementById('loginForm');
const otpBox = document.getElementById('otpBox');
const otpInput = document.getElementById('otp');
const verifyBtn = document.getElementById('verifyBtn');
const otpMsg = document.getElementById('otpMsg');

let step1Email = '';

loginForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  const email = document.getElementById('email').value.trim();

  const res = await fetch('/api/login-step1', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, password, email })
  });

  const data = await res.json();

  if (!data.success) {
    otpMsg.style.color = 'red';
    otpMsg.textContent = data.message;
    return;
  }

  // üî• SHOW OTP IN BROWSER
  alert('Your OTP is: ' + data.otp);

  step1Email = email;
  otpBox.style.display = 'block';
  otpMsg.style.color = 'green';
  otpMsg.textContent = 'Enter OTP shown above';
});

verifyBtn.addEventListener('click', async () => {
  const otp = otpInput.value.trim();

  const res = await fetch('/api/login-step2', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email: step1Email, otp })
  });

  const data = await res.json();

  if (!data.success) {
    otpMsg.style.color = 'red';
    otpMsg.textContent = data.message;
    return;
  }

 localStorage.setItem('currentUser', JSON.stringify(data.user));
 window.location.replace('/dashboard');
 



});
</script>



</body>
</html>
