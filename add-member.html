<!DOCTYPE html>
<html lang="en">
<head>
  <title>Add Member</title>
  <meta charset="UTF-8" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    *{box-sizing:border-box;margin:0;padding:0;}

    body{
      font-family:'Poppins',sans-serif;
      background:linear-gradient(145deg,#e0f2fe,#eef2ff);
      min-height:100vh;
      color:#0f172a;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:32px 16px;
    }

    .page{
      width:100%;
      max-width:900px;
      background:#ffffff;
      border-radius:22px;
      border:1px solid #e5e7eb;
      box-shadow:0 22px 60px rgba(15,23,42,0.18);
      padding:26px 30px 30px;
    }

    .page-header{
      margin-bottom:22px;
      border-bottom:1px solid #e5e7eb;
      padding-bottom:14px;
    }

    .title{
      font-size:1.7rem;
      font-weight:700;
      color:#0f172a;
    }

    .subtitle{
      font-size:0.98rem;
      color:#64748b;
      margin-top:4px;
    }

    .meta-row{
      margin-top:12px;
      display:flex;
      gap:10px;
      font-size:0.8rem;
      flex-wrap:wrap;
    }

    .chip{
      padding:4px 11px;
      border-radius:999px;
      border:1px solid #c7d2fe;
      background:#eff6ff;
      color:#1d4ed8;
    }

    form{
      margin-top:10px;
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:18px 24px;
      background:linear-gradient(135deg,#f8fafc,#eef2ff);
      padding:22px 18px 22px;
      border-radius:16px;
      border:1px solid #e0e7ff;
    }

    .full-row{
      grid-column:1 / -1;
    }

    label{
      display:block;
      font-weight:600;
      font-size:0.88rem;
      color:#1f2937;
      margin-bottom:4px;
    }

    input,select{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #cbd5e1;
      background:#f9fafb;
      font-size:0.92rem;
      color:#0f172a;
      outline:none;
      transition:border-color 0.18s ease,box-shadow 0.18s ease,background 0.18s ease;
    }

    input::placeholder{
      color:#9ca3af;
    }

    input:focus,select:focus{
      border-color:#2563eb;
      background:#ffffff;
      box-shadow:0 0 0 3px rgba(37,99,235,0.16);
    }

    input[type="file"]{
      padding:8px 10px;
      background:#e5edff;
      cursor:pointer;
      font-size:0.84rem;
      border-color:#c7d2fe;
    }

    .hint{
      font-size:0.78rem;
      color:#64748b;
      margin-top:3px;
    }

    .actions{
      grid-column:1 / -1;
      display:flex;
      justify-content:flex-end;
      gap:12px;
      margin-top:6px;
    }

    button{
      min-width:150px;
      padding:11px 0;
      border-radius:999px;
      border:none;
      background:linear-gradient(135deg,#2563eb,#4f46e5);
      color:#f9fafb;
      font-weight:600;
      font-size:0.95rem;
      cursor:pointer;
      box-shadow:0 10px 28px rgba(37,99,235,0.55);
      transition:background 0.18s ease,transform 0.1s ease,box-shadow 0.18s ease;
    }

    button:hover{
      background:linear-gradient(135deg,#1d4ed8,#4338ca);
      transform:translateY(-1px);
      box-shadow:0 14px 34px rgba(37,99,235,0.65);
    }

    @media(max-width:640px){
      .page{padding:20px 14px 22px;}
      form{grid-template-columns:1fr;padding:18px 14px;}
      .actions{flex-direction:column;align-items:stretch;}
      button{width:100%;}
    }

    .home-float{
      position: fixed;
      right: 18px;
      bottom: 20px;
      z-index: 2500;
    }

    .home-float a{
      width: 58px;
      height: 58px;
      border-radius: 50%;
      background: transparent;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      box-shadow: 0 10px 24px rgba(0,0,0,0.35);
      transition: transform 0.12s ease, box-shadow 0.18s ease, filter 0.18s ease;
    }

    .home-float a img{
      width: 46px;
      height: 46px;
      border-radius: 50%;
      display:block;
    }

    .home-float a:hover{
      transform: translateY(-2px);
      box-shadow: 0 14px 34px rgba(0,0,0,0.5);
      filter: brightness(1.05);
    }

    @media (max-width:600px){
      .home-float{
        right:14px;
        bottom:16px;
      }
    }
  </style>
</head>

<div class="home-float">
  <a href="index.html" aria-label="Go to home">
    <img src="img/home.png" alt="Home" />
  </a>
</div>

<body>
  <!-- main admin மட்டுமே இந்த page க்கு access -->
  <script>
    const cu = localStorage.getItem('currentUser');
    if (!cu) {
      window.location.href = 'login.html';
    } else {
      const user = JSON.parse(cu);
      if (user.role !== 'super') {
        alert('Only main admin can add new users.');
        window.location.href = 'dashboard.html';
      }
    }
  </script>

  <div class="page">
    <div class="page-header">
      <div class="title">Add Member</div>
      <div class="subtitle">
        Fill in the member details; this profile will appear in the association members page.
      </div>
      <div class="meta-row">
        <span class="chip">Admin only</span>
        <span class="chip">Profile information</span>
        <span class="chip">Optional photo upload</span>
      </div>
    </div>

    <form id="addMemberForm" enctype="multipart/form-data">
      <div class="full-row">
        <label>Username</label>
        <input type="text" id="username" required placeholder="Login username" />
      </div>

      <div>
        <label>Phone</label>
        <input type="text" id="phone" placeholder="Contact number" />
      </div>

      <div>
        <label>Role</label>
        <select id="role">
          <option value="admin">Admin</option>
          <option value="member">Member</option>
        </select>
      </div>

      <div>
        <label>Joined</label>
        <input type="text" id="joined" placeholder="e.g. October 2025" />
      </div>

      <div class="full-row">
        <label>Photo</label>
        <input type="file" id="photoInput" accept="image/*" />
        <div class="hint">JPEG / PNG, clear face, less than 2MB is recommended.</div>
      </div>

      <div class="actions">
        <button type="submit">Save Member</button>
      </div>
    </form>
  </div>

  <script>
    document.getElementById('addMemberForm').onsubmit = async function(e) {
      e.preventDefault();

      const formData = new FormData();
      formData.append('username', document.getElementById('username').value.trim());
      formData.append('phone', document.getElementById('phone').value);
      formData.append('role', document.getElementById('role').value);
      formData.append('joined', document.getElementById('joined').value);

      const photoFile = document.getElementById('photoInput').files[0];
      if (photoFile) {
        formData.append('photo', photoFile);
      }

      try {
        const res = await fetch('/api/addUserWithPhoto', {
          method: 'POST',
          body: formData
        });

        const data = await res.json();

        if (data.success) {
          alert('Member added successfully!');
          location.href = 'members.html';
        } else {
          alert(data.message || 'Failed to add member.');
        }
      } catch (error) {
        alert('Server error, please try again later.');
        console.error(error);
      }
    };
  </script>
</body>
</html>
