<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Public Services View</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f3b73, #050816);
      color: #f5f7ff;
      margin: 0;
      padding: 40px 15px;
    }

    h1 {
      text-align: center;
      color: #ffffff;
      margin-bottom: 30px;
      font-weight: 700;
      letter-spacing: 1.5px;
      text-transform: uppercase;
    }

    #categoriesContainer {
      max-width: 1000px;
      margin: 0 auto 40px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 24px;
    }

    .category {
      cursor: pointer;
      padding: 18px 12px 16px;
      border-radius: 18px;
      background: rgba(255,255,255,0.08);
      box-shadow: 0 18px 35px rgba(0,0,0,0.55);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      transition: .25s;
    }

    .category:hover {
      transform: translateY(-6px) scale(1.02);
      border-color: #ffd54a;
    }

    .category img {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #fff;
    }

    #selectedCategory {
      text-align: center;
      font-size: 1.4rem;
      color: #ffeb99;
    }

    #membersContainer {
      max-width: 650px;
      margin: auto;
      background: rgba(0,0,0,.35);
      border-radius: 16px;
      padding: 12px 18px;
    }

    .member-entry {
      padding: 10px 4px;
      border-bottom: 1px solid rgba(255,255,255,.12);
    }
  </style>
</head>

<body>

<h1>Service Categories</h1>
<div id="categoriesContainer"></div>

<h2 id="selectedCategory">Select a category</h2>
<div id="membersContainer"></div>

<script>
/* ✅ IMPORTANT */
const API_BASE = 'https://ambalnagar.onrender.com';

const categoriesContainer = document.getElementById('categoriesContainer');
const membersContainer = document.getElementById('membersContainer');
const selectedCategory = document.getElementById('selectedCategory');

async function loadCategories() {
  try {
    const res = await fetch(API_BASE + '/api/categories');
    const categories = await res.json();

    categoriesContainer.innerHTML = '';

    categories.forEach(cat => {
      const div = document.createElement('div');
      div.className = 'category';

      div.innerHTML = `
        <img src="${cat.image || '/img/services/default.png'}" alt="${cat.name}">
        <span>${cat.name}</span>
      `;

      div.onclick = () => loadMembers(cat.id, cat.name);
      categoriesContainer.appendChild(div);
    });
  } catch (e) {
    categoriesContainer.innerHTML = '<p>Failed to load categories</p>';
  }
}

async function loadMembers(catId, catName) {
  selectedCategory.textContent = catName;
  membersContainer.innerHTML = 'Loading members...';

  try {
    const res = await fetch(API_BASE + '/api/members/' + catId);
    const members = await res.json();

    if (!members.length) {
      membersContainer.innerHTML = '<p>No members added yet.</p>';
      return;
    }

    membersContainer.innerHTML = '';
    members.forEach(m => {
      const div = document.createElement('div');
      div.className = 'member-entry';
      div.innerHTML = `<strong>${m.name}</strong> — Phone: ${m.phone}`;
      membersContainer.appendChild(div);
    });
  } catch (e) {
    membersContainer.innerHTML = '<p>Failed to load members.</p>';
  }
}

loadCategories();
</script>

</body>
</html>