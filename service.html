<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Public Services View</title>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f3b73, #050816);
      color: #f5f7ff;
      margin: 0;
      padding: 40px 15px;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
      letter-spacing: 1.5px;
      text-transform: uppercase;
    }

    #categoriesContainer {
      max-width: 1000px;
      margin: 0 auto 40px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 24px;
    }

    .category {
      cursor: pointer;
      padding: 16px;
      border-radius: 18px;
      background: rgba(255,255,255,0.08);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      transition: 0.3s;
    }

    .category:hover {
      transform: translateY(-4px);
      border: 1px solid #ffd54a;
    }

    .category img {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      object-fit: cover;
    }

    #selectedCategory {
      text-align: center;
      margin-bottom: 10px;
      color: #ffeb99;
    }

    #membersContainer {
      max-width: 650px;
      margin: auto;
      background: rgba(0,0,0,0.35);
      border-radius: 14px;
      padding: 12px;
    }

    .member-entry {
      padding: 8px;
      border-bottom: 1px solid rgba(255,255,255,0.15);
    }
  </style>
</head>

<body>

<h1>Service Categories</h1>

<div id="categoriesContainer"></div>

<h2 id="selectedCategory">Select a category</h2>
<div id="membersContainer"></div>

<script>
/* ===============================
   CONFIG
================================ */
const API_BASE = 'https://ambalnagar.onrender.com';

/* ===============================
   ELEMENTS
================================ */
const categoriesContainer = document.getElementById('categoriesContainer');
const membersContainer = document.getElementById('membersContainer');
const selectedCategory = document.getElementById('selectedCategory');

/* ===============================
   LOAD CATEGORIES
================================ */
async function loadCategories() {
  try {
    const res = await fetch(API_BASE + '/api/categories');
    const categories = await res.json();

    categoriesContainer.innerHTML = '';

    categories.forEach(cat => {
      const div = document.createElement('div');
      div.className = 'category';

      div.innerHTML = `
        <img src="${cat.image ? cat.image : '/img/services/default.png'}">
        <span>${cat.name}</span>
      `;

      div.onclick = () => loadMembers(cat.id, cat.name);
      categoriesContainer.appendChild(div);
    });

  } catch (err) {
    console.error(err);
    categoriesContainer.innerHTML = '<p>Error loading categories</p>';
  }
}

/* ===============================
   LOAD MEMBERS
================================ */
async function loadMembers(categoryId, categoryName) {
  selectedCategory.textContent = categoryName;
  membersContainer.innerHTML = 'Loading...';

  try {
    const res = await fetch(API_BASE + '/api/members/' + categoryId);
    const members = await res.json();

    if (!members.length) {
      membersContainer.innerHTML = '<p>No members found</p>';
      return;
    }

    membersContainer.innerHTML = '';
    members.forEach(m => {
      const div = document.createElement('div');
      div.className = 'member-entry';
      div.innerHTML = `<strong>${m.name}</strong> â€” ${m.phone}`;
      membersContainer.appendChild(div);
    });

  } catch (err) {
    console.error(err);
    membersContainer.innerHTML = '<p>Error loading members</p>';
  }
}

/* ===============================
   INIT
================================ */
loadCategories();
</script>

</body>
</html>
