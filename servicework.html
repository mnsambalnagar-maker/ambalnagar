<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard - Category & Member Management</title>

  <style>
    :root{
      --bg:#020617;
      --card:#0b1220;
      --card-alt:#111827;
      --accent:#14b8a6;
      --accent-soft:#a5f3fc;
      --text-main:#e5e7eb;
      --text-muted:#9ca3af;
      --danger:#ef4444;
    }

    *{box-sizing:border-box}

    body{
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#1f3b73,var(--bg));
      color:var(--text-main);
      margin:0;
      padding:24px;
    }

    h1{
      text-align:center;
      color:#fff;
      letter-spacing:1.5px;
    }

    h2{
      color:var(--accent-soft);
      margin-bottom:10px;
    }

    .layout{
      max-width:1180px;
      margin:0 auto;
      display:grid;
      grid-template-columns:1.1fr 1.2fr;
      gap:24px;
    }

    .form-section{
      background:linear-gradient(145deg,var(--card),var(--card-alt));
      border-radius:16px;
      padding:18px;
      border:1px solid rgba(148,163,184,0.35);
    }

    label{
      display:block;
      font-size:.85rem;
      color:var(--accent-soft);
      margin-top:6px;
    }

    input,select{
      width:100%;
      padding:7px 9px;
      margin-bottom:6px;
      border-radius:8px;
      border:1px solid #374151;
      background:#020617;
      color:var(--text-main);
    }

    .btn-row{
      display:flex;
      gap:8px;
      margin-top:6px;
    }

    button{
      padding:7px 14px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      font-weight:600;
    }

    .btn-primary{
      background:linear-gradient(135deg,#14b8a6,#22c55e);
      color:#021014;
    }

    .btn-ghost{
      background:transparent;
      color:var(--text-muted);
      border:1px solid #4b5563;
    }

    .btn-small{
      padding:4px 10px;
      font-size:.8rem;
      border-radius:999px;
    }

    .btn-edit{background:#0ea5e9;color:#021018}
    .btn-delete{background:var(--danger);color:#fff}

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
      font-size:.86rem;
    }

    th,td{
      padding:7px 9px;
      border-bottom:1px solid #1f2937;
    }

    @media(max-width:900px){
      .layout{grid-template-columns:1fr}
    }
  </style>
</head>

<body>

<h1>Service Dashboard</h1>

<div class="layout">

  <!-- CATEGORY -->
  <div class="form-section">
    <h2>Manage Categories</h2>

    <form id="categoryForm">
      <input type="hidden" id="categoryId">

      <label>Category ID</label>
      <input id="categoryInputId" required>

      <label>Category Name</label>
      <input id="categoryInputName" required>

      <div class="btn-row">
        <button class="btn-primary" type="submit">Save Category</button>
        <button class="btn-ghost" type="button" id="categoryCancel">Cancel</button>
      </div>
    </form>

    <table>
      <thead>
        <tr><th>ID</th><th>Name</th><th>Actions</th></tr>
      </thead>
      <tbody id="categoriesTable"></tbody>
    </table>
  </div>

  <!-- MEMBERS -->
  <div class="form-section">
    <h2>Manage Members</h2>

    <form id="memberForm">
      <input type="hidden" id="memberId">

      <label>Name</label>
      <input id="memberName" required>

      <label>Phone</label>
      <input id="memberPhone" required pattern="[0-9]{10}">

      <label>Category</label>
      <select id="memberCategory" required>
        <option value="">Select Category</option>
      </select>

      <div class="btn-row">
        <button class="btn-primary" type="submit">Save Member</button>
        <button class="btn-ghost" type="button" id="memberCancel">Cancel</button>
      </div>
    </form>

    <table>
      <thead>
        <tr><th>Name</th><th>Phone</th><th>Category</th><th>Actions</th></tr>
      </thead>
      <tbody id="membersTable"></tbody>
    </table>
  </div>

</div>

<script>
const API_BASE = 'https://ambalnagar.onrender.com';

const categoriesTable = document.getElementById('categoriesTable');
const membersTable = document.getElementById('membersTable');
const memberCategory = document.getElementById('memberCategory');

const categoryForm = document.getElementById('categoryForm');
const categoryId = document.getElementById('categoryId');
const categoryInputId = document.getElementById('categoryInputId');
const categoryInputName = document.getElementById('categoryInputName');
const categoryCancel = document.getElementById('categoryCancel');

const memberForm = document.getElementById('memberForm');
const memberId = document.getElementById('memberId');
const memberName = document.getElementById('memberName');
const memberPhone = document.getElementById('memberPhone');
const memberCancel = document.getElementById('memberCancel');

let categoryMap = new Map();

/* LOAD CATEGORIES */
async function loadCategories(){
  const res = await fetch(API_BASE+'/api/categories');
  const cats = await res.json();

  categoriesTable.innerHTML = '';
  memberCategory.innerHTML = '<option value="">Select Category</option>';
  categoryMap.clear();

  cats.forEach(c=>{
    categoryMap.set(c.id,c.name);

    categoriesTable.innerHTML += `
      <tr>
        <td>${c.id}</td>
        <td>${c.name}</td>
        <td>
          <button class="btn-small btn-edit" onclick="editCategory('${c.id}')">Edit</button>
          <button class="btn-small btn-delete" onclick="deleteCategory('${c.id}')">Delete</button>
        </td>
      </tr>
    `;

    const opt = document.createElement('option');
    opt.value = c.id;
    opt.textContent = c.name;
    memberCategory.appendChild(opt);
  });
}

/* LOAD MEMBERS */
async function loadMembers(){
  const res = await fetch(API_BASE+'/api/members');
  const mems = await res.json();

  membersTable.innerHTML = '';

  mems.forEach(m=>{
    membersTable.innerHTML += `
      <tr>
        <td>${m.name}</td>
        <td>${m.phone}</td>
        <td>${categoryMap.get(m.category) || ''}</td>
        <td>
          <button class="btn-small btn-edit" onclick="editMember('${m.id}')">Edit</button>
          <button class="btn-small btn-delete" onclick="deleteMember('${m.id}')">Delete</button>
        </td>
      </tr>
    `;
  });
}

/* SAVE CATEGORY */
categoryForm.onsubmit = async e=>{
  e.preventDefault();

  const id = categoryInputId.value.trim();
  const name = categoryInputName.value.trim();

  if(categoryId.value){
    await fetch(API_BASE+'/api/categories/'+categoryId.value,{
      method:'PUT',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({name})
    });
  }else{
    await fetch(API_BASE+'/api/categories',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({id,name})
    });
  }

  categoryForm.reset();
  await loadCategories();
  await loadMembers();
};

/* SAVE MEMBER */
memberForm.onsubmit = async e=>{
  e.preventDefault();

  const body={
    name:memberName.value,
    phone:memberPhone.value,
    category:memberCategory.value
  };

  if(memberId.value){
    await fetch(API_BASE+'/api/members/'+memberId.value,{
      method:'PUT',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(body)
    });
  }else{
    await fetch(API_BASE+'/api/members',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(body)
    });
  }

  memberForm.reset();
  await loadMembers();
};

/* EDIT / DELETE */
window.editCategory = async id=>{
  const res = await fetch(API_BASE+'/api/categories');
  const c = (await res.json()).find(x=>x.id===id);
  if(!c) return;

  categoryId.value = c.id;
  categoryInputId.value = c.id;
  categoryInputName.value = c.name;
};

window.deleteCategory = async id=>{
  await fetch(API_BASE+'/api/categories/'+id,{method:'DELETE'});
  await loadCategories();
  await loadMembers();
};

window.editMember = async id=>{
  const res = await fetch(API_BASE+'/api/members');
  const m = (await res.json()).find(x=>x.id===id);
  if(!m) return;

  memberId.value = m.id;
  memberName.value = m.name;
  memberPhone.value = m.phone;
  memberCategory.value = m.category;
};

window.deleteMember = async id=>{
  await fetch(API_BASE+'/api/members/'+id,{method:'DELETE'});
  await loadMembers();
};

/* CANCEL */
categoryCancel.onclick = ()=>categoryForm.reset();
memberCancel.onclick = ()=>memberForm.reset();

/* INIT */
document.addEventListener('DOMContentLoaded',async()=>{
  await loadCategories();
  await loadMembers();
});
</script>

</body>
</html>
